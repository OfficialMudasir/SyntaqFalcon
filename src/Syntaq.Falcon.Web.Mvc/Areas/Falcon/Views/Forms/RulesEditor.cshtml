@using Newtonsoft.Json
@using Syntaq.Falcon.Forms.Dtos;
@using Abp.AspNetZeroCore.Timing
@inject AppTimes AppTimes

@model GetFormForEditOutput


<script src="~/assets/formio/app/jquery/jquery.min.js"></script>
<link href="~/assets/Bootstrap/bootstrap.min.css" rel="stylesheet" />
<script src="~/assets/Bootstrap/bootstrap.min.js"></script>
 

<link href="~/metronic/src/vendors/fontawesome5/css/fontawesome.min.css" rel="stylesheet" />
<link rel="stylesheet" href="/assets/formio/app/fontawesome/css/fontawesome.min.css?v=sOcjrl5oE7mSq9nXWOek4j4RJtBQp63l1mFMjUi7VBA" />

<link rel="stylesheet" href="/assets/logicapp/query-builder.default.css" id="qb-theme" />
<link rel="stylesheet" href="/assets/logicapp/styles.css" />
<link rel="stylesheet" abp-href="/view-resources/Areas/Falcon/Views/_Bundles/vendors.bundle.css" asp-append-version="true" />
<link rel="stylesheet" abp-href="/view-resources/Areas/Falcon/Views/_Bundles/app-layout-libs.css" asp-append-version="true" />
<link rel="stylesheet" abp-href="/view-resources/Areas/Falcon/Views/_Bundles/common-styles.css" asp-append-version="true" />
<link rel="stylesheet" abp-href="/Common/Scripts/Datatables/datatables.css" asp-append-version="true" />
<link rel="stylesheet" abp-href="/Common/Scripts/Datatables/datatables-rtl.css" asp-append-version="true" />
<link rel="stylesheet" abp-href="/Common/Styles/metronic-customize.css" asp-append-version="true" />

<link rel="stylesheet" abp-href="/view-resources/Areas/Falcon/Views/Layout/_Layout.css" asp-append-version="true" />

<style>
    .form-control {
        font-family: sans-serif, Arial;
        border-radius: 0;
        border-radius: 0.25rem;
    }

    .p-2 {
        padding: .8em;
    }

    .bottom {
        white-space: normal;
    }

    .conditions-section > .row-fluid {
        white-space: initial;
    }

    .sections > .condition {
        white-space: initial;
    }

    .dataTables_wrapper .dataTables_paginate {
        float: unset;
    }

    .btn-add-action {
        margin-left: 5px;
    }

    .btn-clear-action {
        margin-left: 5px;
    }

    .yes-block {
        width: 50%;
    }

    .no-block {
        width: 50%;
    }
</style>

@{
    Layout = "~/Areas/Falcon/Views/Layout/_Layout.min.notheme.cshtml";
}
<div class="container-fluid" style="padding-top: 1em; padding-bottom: 1em;">
    <div id="container">
        <ul class="nav nav-tabs" role="tablist">
            <li class="active">
                <a id="rulelisttab" href="#rulelist" role="tab" data-bs-toggle="tab" data-toggle="tab">
                    <strong> Rules</strong>
                </a>
            </li>
            <li>
                <a id="rulebuildtab" href="#rulebuild" role="tab" data-bs-toggle="tab" data-toggle="tab" class="font-weight-bold">
                    <strong> Rule Builder</strong>
                </a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" style=" " id="rulelist">
                <button id="ImportRulesButton" class="btn btn-outline-primary m-btn m-btn--custom m-btn--outline-2x m-btn--bolder" style="margin: 2.5px 5px 2.5px 2.5px; display: inline-block; position: relative; float: right;">  @L("ImportRules")</button>
                <button id="ExportRulesButton" class="btn btn-outline-success m-btn m-btn--custom m-btn--outline-2x m-btn--bolder" style="margin: 2.5px 2.5px; display: inline-block; position: relative; float: right;" onclick="location.href='/Falcon/FormRules/GetRulesForDownload?FormId=@Html.Raw(Model.Form.Id.ToString())'">  @L("ExportRules")</button>
                <button id="CreateRuleButton" class="btn btn-outline-success m-btn m-btn--custom m-btn--outline-2x m-btn--bolder" href="#rulebuild" data-bs-toggle="tab" data-toggle="tab" style="margin: 2.5px 2.5px; display: inline-block; position: relative; float: right;">  @L("CreateRule")</button>
                <div class="alert alert-warning mt-2" style="position: relative; padding: 7.5px 15px; margin: 0px 10px; clear:both;white-space: normal;">
                    <strong>  Important:</strong> If you can't see your recently added fields in the rules builder, try saving the form first and then reload the rules editor.
                </div>
                <div class="rules-list-table-container m-2" style="  border: 1px solid #ddd;">
                    <table id="FormRulesTable" class="display table table-striped table-bordered table-hover dt-responsive nowrap" style="margin-top: 0px !important;">
                        <thead>
                            <tr>
                                <th>@L("Name")</th>
                                <th>@L("LastModified")</th>
                                <th>@L("Validation")</th>
                                <th>@L("Actions")</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <div class="tab-pane" id="rulebuild">
                <div class="px-2  ">
                    <div class="col-12 p-2 border bg-light">
                        <input class="form-control" id="FormId" value="@Model.Form.Id" type="hidden" name="FormId" />
                        <input class="form-control" id="RuleId" type="hidden" name="RuleId" />
                        <div class="col-6 " style="padding-left: 1.75em">
                            <div style="font-weight:700  " for="Rule_Name">@L("RuleName")</div>
                            <input class="form-control  " style=" display: inline-block;width: 40%" id="Rule_Name" type="text" name="rulename" />
                            <button style="margin-bottom:.27em" type="button" class="btn btn-outline-success" id="btn-create-rules">  Create Rule</button>
                            <button style="margin-bottom:.27em" type="button" class="btn btn-outline-primary" id="btn-save-rules">  Save Rule</button>
                            <button style="margin-bottom:.27em" type="button" class="btn btn-outline-danger" id="btn-clear-rules"> Clear Rule</button>
                        </div>
                    </div>
                </div>
                <div class="  ">
                    <hr class="col-12" style="margin-top:0" />
                </div>
                <div class="querybuildercontainer" style="overflow: hidden; height:80vh; width: 100%; padding: 0px 5px;">
                    <div class="querybuilder">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts
    {


    <script src="~/assets/logicapp/panzoom.js"></script>
    <script src="~/view-resources/Areas/Falcon/Views/_Bundles/minimal-app-layout-libs.js"></script>

    <script abp-src="/view-resources/Areas/Falcon/Views/_Bundles/common-scripts.js" asp-append-version="true"></script>
    <script src="~/assets/logicapp/query-builder.standalone.js"></script>
    <script src="~/assets/logicapp/himalaya.js"></script>

    <script src="~/view-resources/Areas/Falcon/Views/Forms/RulesEditor.js"></script>
    <script src="~/assets/logicapp/app.js"></script>
    <script src="~/assets/logicapp/parseComponent-0.1.0.js"></script>

    <script src="~/lib/jquery-form/src/jquery.form.js"></script>
    <script src="~/lib/underscore/underscore.js"></script>

    <script type="text/javascript">
        var JSONFormObj = @Html.Raw(JsonConvert.DeserializeObject(JsonConvert.SerializeObject(Model.Form)));
        document.title = "Rules for " + JSONFormObj.Name + "";
        var formFieldNames = new Array();
    </script>

}